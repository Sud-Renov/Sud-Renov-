<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ü–ª–∞–Ω—É–≤–∞–Ω–Ω—è –¥–Ω—è ‚Äî Planning du jour</title>
  <style>
    :root {
      --bg: #111827;
      --panel: #1f2937;
      --text: #f9fafb;
      --muted: #9ca3af;
      --accent: #60a5fa;
      --ok: #10b981;
      --warn: #f59e0b;
    }
    html, body { height: 100%; background: var(--bg); color: var(--text); font-family: system-ui, -apple-system, Segoe UI, Roboto, 'Noto Sans', 'Noto Sans Ukrainian', Arial, sans-serif; }
    .container { max-width: 1200px; margin: 0 auto; padding: 24px; }
    header { display: flex; align-items: center; justify-content: space-between; gap: 16px; margin-bottom: 16px; }
    h1 { font-size: 1.8rem; margin: 0; }
    .sub { color: var(--muted); font-size: 0.95rem; }
    .controls { display: flex; align-items: center; gap: 8px; }
    .btn {
      background: var(--panel); border: 1px solid #374151; color: var(--text);
      padding: 10px 14px; border-radius: 8px; cursor: pointer; font-weight: 600;
    }
    .btn:hover { border-color: var(--accent); }
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px; }
    .card { background: var(--panel); border: 1px solid #374151; border-radius: 12px; overflow: hidden; display: flex; flex-direction: column; }
    .thumb { aspect-ratio: 4 / 3; width: 100%; object-fit: cover; background: #0b1220; }
    .card-body { padding: 12px; display: grid; gap: 6px; }
    .title { font-weight: 700; }
    .row { display: flex; align-items: center; gap: 8px; color: var(--muted); font-size: 0.95rem; }
    .badge { display: inline-block; padding: 4px 8px; border-radius: 999px; font-size: 0.8rem; border: 1px solid #374151; }
    .status-ok { color: #d1fae5; border-color: var(--ok); }
    .status-warn { color: #ffedd5; border-color: var(--warn); }
    footer { margin-top: 16px; display: flex; justify-content: space-between; align-items: center; color: var(--muted); }
    .ticker { overflow: hidden; white-space: nowrap; width: 100%; }
    .ticker span { display: inline-block; padding-left: 100%; animation: marquee 24s linear infinite; }
    @keyframes marquee { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }
    /* Lisibilit√© √©cran */
    * { user-select: none; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1 id="heading">–ü–ª–∞–Ω—É–≤–∞–Ω–Ω—è –¥–Ω—è</h1>
        <div class="sub" id="dateLine"></div>
      </div>
      <div class="controls">
        <button class="btn" id="langToggle" aria-label="Basculer la langue">–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</button>
        <button class="btn" id="refreshBtn" aria-label="Recharger">‚Üª</button>
      </div>
    </header>

    <div class="grid" id="grid" role="list"></div>

    <footer>
      <div class="ticker"><span id="tickerText"></span></div>
      <div id="lastUpdate" class="sub"></div>
    </footer>
  </div>

  <script>
    // Traductions UI
    const i18n = {
      uk: {
        heading: "–ü–ª–∞–Ω—É–≤–∞–Ω–Ω—è –¥–Ω—è",
        datePrefix: "–î–∞—Ç–∞:",
        crew: "–ë—Ä–∏–≥–∞–¥–∞",
        start: "–ü–æ—á–∞—Ç–æ–∫",
        address: "–ê–¥—Ä–µ—Å–∞",
        status_ok: "–ù–∞ –º—ñ—Å—Ü—ñ",
        status_warn: "–ó–∞—Ç—Ä–∏–º–∫–∞",
        ticker: "–ë–µ–∑–ø–µ–∫–∞ –ø–µ—Ä—à –∑–∞ –≤—Å–µ. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∑–∞—Å–æ–±–∏ —ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–æ–≥–æ –∑–∞—Ö–∏—Å—Ç—É.",
        langLabel: "–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞",
        lastUpdate: "–û–Ω–æ–≤–ª–µ–Ω–æ:"
      },
      fr: {
        heading: "Planning du jour",
        datePrefix: "Date :",
        crew: "√âquipe",
        start: "D√©but",
        address: "Adresse",
        status_ok: "Sur site",
        status_warn: "Retard",
        ticker: "La s√©curit√© avant tout. V√©rifiez vos EPI.",
        langLabel: "Fran√ßais",
        lastUpdate: "Mis √† jour :"
      }
    };

    // Pr√©f√©rence de langue
    let lang = localStorage.getItem("lang") || "uk";

    const els = {
      heading: document.getElementById("heading"),
      dateLine: document.getElementById("dateLine"),
      grid: document.getElementById("grid"),
      langToggle: document.getElementById("langToggle"),
      refreshBtn: document.getElementById("refreshBtn"),
      tickerText: document.getElementById("tickerText"),
      lastUpdate: document.getElementById("lastUpdate"),
    };

    function formatDate(d, locale) {
      return new Intl.DateTimeFormat(locale, { weekday: "long", year: "numeric", month: "long", day: "numeric" }).format(d);
    }

    function setLang(newLang) {
      lang = newLang;
      localStorage.setItem("lang", lang);
      const t = i18n[lang];
      document.documentElement.lang = lang === "fr" ? "fr" : "uk";
      els.heading.textContent = t.heading;
      els.dateLine.textContent = `${t.datePrefix} ${formatDate(new Date(), lang === "fr" ? "fr-FR" : "uk-UA")}`;
      els.langToggle.textContent = t.langLabel;
      els.tickerText.textContent = t.ticker;
      renderCards(currentData);
      els.lastUpdate.textContent = `${t.lastUpdate} ${lastUpdated || "‚Äî"}`;
    }

    // Chargement des donn√©es
    let currentData = [];
    let lastUpdated = "";

    async function loadData() {
      try {
        const res = await fetch("planning.json?ts=" + Date.now());
        if (!res.ok) throw new Error("no json");
        const data = await res.json();
        currentData = Array.isArray(data) ? data : (data.items || []);
        lastUpdated = new Date().toLocaleString(lang === "fr" ? "fr-FR" : "uk-UA");
      } catch (e) {
        // Donn√©es de secours
        currentData = [
          {
            title: { uk: "–ë—É–¥–º–∞–π–¥–∞–Ω—á–∏–∫: –†–µ–º–æ–Ω—Ç —Ñ–∞—Å–∞–¥—É", fr: "Chantier: R√©novation de fa√ßade" },
            address: { uk: "–ú–∞—Ä—Å–µ–ª—å, 13008", fr: "Marseille, 13008" },
            start: "08:00",
            crew: "–ë—Ä–∏–≥–∞–¥–∞ A / √âquipe A",
            status: "ok",
            photo: "images/facade.jpg"
          },
          {
            title: { uk: "–ú–æ–Ω—Ç–∞–∂ —Å–∞–Ω—Ç–µ—Ö–Ω—ñ–∫–∏", fr: "Installation plomberie" },
            address: { uk: "–ê–ª–ª–æ, 13190", fr: "Allauch, 13190" },
            start: "09:30",
            crew: "–ë—Ä–∏–≥–∞–¥–∞ B / √âquipe B",
            status: "warn",
            photo: "images/plomberie.jpg"
          }
        ];
        lastUpdated = new Date().toLocaleString(lang === "fr" ? "fr-FR" : "uk-UA");
      }
      renderCards(currentData);
      setLang(lang); // actualiser textes d√©pendants
    }

    function renderCards(items) {
      const t = i18n[lang];
      els.grid.innerHTML = "";
      items.forEach((item) => {
        const title = item.title?.[lang] || item.title || "";
        const address = item.address?.[lang] || item.address || "";
        const statusLabel = item.status === "ok" ? t.status_ok : t.status_warn;
        const statusClass = item.status === "ok" ? "status-ok" : "status-warn";
        const card = document.createElement("article");
        card.className = "card";
        card.setAttribute("role", "listitem");
        card.innerHTML = `
          <img class="thumb" src="${item.photo || "images/placeholder.jpg"}" alt="${title}" />
          <div class="card-body">
            <div class="title">${title}</div>
            <div class="row">üè† ${t.address}: ${address}</div>
            <div class="row">üïó ${t.start}: ${item.start || "‚Äî"}</div>
            <div class="row">üë∑ ${t.crew}: ${item.crew || "‚Äî"}</div>
            <div class="row"><span class="badge ${statusClass}">${statusLabel}</span></div>
          </div>
        `;
        els.grid.appendChild(card);
      });
    }

    // √âv√©nements UI
    els.langToggle.addEventListener("click", () => setLang(lang === "fr" ? "uk" : "fr"));
    els.refreshBtn.addEventListener("click", () => loadData());

    // Auto-refresh toutes les 5 minutes (optionnel)
    setInterval(loadData, 5 * 60 * 1000);

    // Start
    setLang(lang);
    loadData();
  </script>
</body>
</html>
