<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="utf-8">
<title>–ü–ª–∞–Ω —Ä–æ–±—ñ—Ç –Ω–∞ –¥–µ–Ω—å</title>
<style>
  body {
    font-family: "Segoe UI", Arial, sans-serif;
    background:#0f172a;
    color:#f8fafc;
    margin:0;
    padding:20px;
    display:flex;
    flex-direction:column;
    align-items:center;
  }
  h1 {
    text-align:center;
    margin-bottom:20px;
    color:#60a5fa;
  }
  .lang-toggle {
    text-align:center;
    margin-bottom:20px;
  }
  .lang-toggle button {
    background:#2563eb;
    color:#fff;
    border:none;
    padding:8px 14px;
    border-radius:6px;
    cursor:pointer;
    font-weight:bold;
    font-size:1rem;
    display:inline-flex;
    align-items:center;
    gap:8px;
  }
  .lang-toggle img {
    width:20px;
    height:14px;
  }
  .grid {
    display:grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap:20px;
    max-width:1000px;
    width:100%;
    justify-items:center;
  }
  .site {
    background:#1f2937;
    border-radius:12px;
    overflow:hidden;
    box-shadow:0 4px 8px rgba(0,0,0,0.3);
    width:250px;
  }
  .site img {
    width:100%;
    height:140px;
    object-fit:cover;
  }
  .site-body {
    padding:12px;
  }
  .site-body strong {
    font-size:1.1rem;
    color:#facc15;
  }
  .crew {
    margin-top:8px;
    font-size:0.9rem;
    color:#93c5fd;
    padding:0 12px 12px;
  }
  .marquee {
    width:100%;
    margin-top:20px;
    overflow:hidden;
    white-space:nowrap;
  }
  .marquee span {
    display:inline-block;
    padding-left:100%;
    animation: scroll 15s linear infinite;
  }
  @keyframes scroll {
    0% { transform: translateX(0); }
    100% { transform: translateX(-100%); }
  }
</style>
</head>
<body>

<h1 id="pageTitle">–ü–ª–∞–Ω —Ä–æ–±—ñ—Ç –Ω–∞ –¥–µ–Ω—å</h1>

<div class="lang-toggle">
  <button id="langBtn" onclick="toggleLang()">
    <img id="langFlag" src="/images/fr.png" alt="Fran√ßais">
    <span id="langLabel">Fran√ßais</span>
  </button>
</div>

<div id="sitesGrid" class="grid"></div>

<div class="marquee">
  <span>üöß –ü–ª–∞–Ω—É–≤–∞–Ω–Ω—è —Ä–æ–±—ñ—Ç ‚Äî –¥–∞–Ω—ñ –∑ admin.html üöß</span>
</div>

<script>
let sites = [];
let currentLang = "uk"; // ukrainien par d√©faut

function renderSites() {
  const grid = document.getElementById("sitesGrid");
  grid.innerHTML = "";

  sites.forEach(site => {
    const title = site.title?.[currentLang] || site.title?.uk || site.title?.fr || "";
    const address = site.address?.[currentLang] || site.address?.uk || site.address?.fr || "";
    const notes = site.notes || "";

    const card = document.createElement("div");
    card.className = "site";

    card.innerHTML = `
      ${site.photo ? `<img src="${site.photo}" alt="–§–æ—Ç–æ –æ–±'—î–∫—Ç–∞">` : ""}
      <div class="site-body">
        <strong>${title}</strong><br>
        üìç ${address}<br>
        üìù ${notes}<br>
      </div>
    `;

    const crewDiv = document.createElement("div");
    crewDiv.className = "crew";
    (site.crew || []).forEach(c => {
      const span = document.createElement("span");
      span.textContent = (c.type === "ouvrier" ? "üë∑ " : "üõ†Ô∏è ") + c.name;
      crewDiv.appendChild(span);
    });
    card.appendChild(crewDiv);

    grid.appendChild(card);
  });

  // Mettre √† jour les libell√©s et le bouton selon la langue
  const pageTitle = document.getElementById("pageTitle");
  const marquee = document.querySelector(".marquee span");
  const langFlag = document.getElementById("langFlag");
  const langLabel = document.getElementById("langLabel");

  if (currentLang === "uk") {
    pageTitle.textContent = "–ü–ª–∞–Ω —Ä–æ–±—ñ—Ç –Ω–∞ –¥–µ–Ω—å";
    marquee.textContent = "üöß –ü–ª–∞–Ω—É–≤–∞–Ω–Ω—è —Ä–æ–±—ñ—Ç ‚Äî –¥–∞–Ω—ñ –∑ admin.html üöß";
    langFlag.src = "/images/fr.png";
    langFlag.alt = "Fran√ßais";
    langLabel.textContent = "Fran√ßais";
  } else {
    pageTitle.textContent = "Planning du jour";
    marquee.textContent = "üöß Organisation des chantiers ‚Äî donn√©es depuis admin.html üöß";
    langFlag.src = "/images/ua.png";
    langFlag.alt = "–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞";
    langLabel.textContent = "–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞";
  }
}

function toggleLang() {
  currentLang = currentLang === "uk" ? "fr" : "uk";
  renderSites();
}

// Charger le JSON export√© par admin.html
fetch("planning.json?ts=" + Date.now())
  .then(r => {
    if (!r.ok) throw new Error("Impossible de charger planning.json");
    return r.json();
  })
  .then(data => {
    sites = data;
    renderSites();
  })
  .catch(err => {
    document.getElementById("sitesGrid").innerHTML = "<p style='color:red'>Erreur : " + err.message + "</p>";
    console.error(err);
  });
</script>

</body>
</html>