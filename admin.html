<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<title>Admin planning</title>
<style>
  body { font-family: Arial, sans-serif; display:flex; gap:20px; margin:20px; }
  .sidebar { width:220px; }
  .chip { background:#60a5fa; color:#fff; padding:8px 12px; margin:5px 0; border-radius:6px; cursor:grab; }
  .chip:active { cursor:grabbing; }
  .site { border:1px solid #ccc; border-radius:8px; padding:10px; margin-bottom:15px; background:#f9fafb; }
  .droppable { min-height:40px; border:2px dashed #60a5fa; padding:8px; border-radius:6px; margin-top:8px; }
  .droppable.dragover { background:#dbeafe; }
  .tag { background:#93c5fd; border-radius:999px; padding:4px 8px; margin:4px; display:inline-block; }
</style>
</head>
<body>

<div class="sidebar">
  <h3>Ouvriers</h3>
  <input id="workerName" placeholder="Nom de l'ouvrier">
  <button onclick="addWorker()">Ajouter</button>
  <div id="workersList"></div>

  <h3>TÃ¢ches</h3>
  <input id="taskName" placeholder="Nom de la tÃ¢che">
  <button onclick="addTask()">Ajouter</button>
  <div id="tasksList"></div>

  <button onclick="exportJSON()">â¬‡ï¸ Exporter JSON</button>
</div>

<div class="main">
  <h2>Chantiers du jour</h2>
  <input id="siteTitle" placeholder="Titre du chantier">
  <input id="siteAddress" placeholder="Adresse">
  <input id="siteStart" placeholder="Heure de dÃ©but (ex: 08:00)">
  <input id="sitePhoto" placeholder="Chemin photo (ex: images/chantier.jpg)">
  <button onclick="addSite()">Ajouter chantier</button>

  <div id="sitesGrid"></div>
</div>

<script>
let workers = [];
let tasks = [];
let sites = [];

function makeChip(type, name) {
  const div = document.createElement("div");
  div.className = "chip";
  div.textContent = (type==="ouvrier"?"ğŸ‘· ":"ğŸ› ï¸ ") + name;
  div.draggable = true;
  div.dataset.type = type;
  div.dataset.name = name;
  div.addEventListener("dragstart", e => {
    e.dataTransfer.setData("text/plain", JSON.stringify({type, name}));
  });
  return div;
}

function addWorker() {
  const name = document.getElementById("workerName").value.trim();
  if (!name) return;
  workers.push(name);
  document.getElementById("workersList").appendChild(makeChip("ouvrier", name));
  document.getElementById("workerName").value="";
}

function addTask() {
  const name = document.getElementById("taskName").value.trim();
  if (!name) return;
  tasks.push(name);
  document.getElementById("tasksList").appendChild(makeChip("tache", name));
  document.getElementById("taskName").value="";
}

function addSite() {
  const title = document.getElementById("siteTitle").value.trim();
  const address = document.getElementById("siteAddress").value.trim();
  const start = document.getElementById("siteStart").value.trim();
  const photo = document.getElementById("sitePhoto").value.trim();
  if (!title || !address) return;
  const id = "site"+Math.random().toString(36).slice(2,9);
  sites.push({id,title,address,start,photo,crew:[],status:"ok"});
  renderSites();
  document.getElementById("siteTitle").value="";
  document.getElementById("siteAddress").value="";
  document.getElementById("siteStart").value="";
  document.getElementById("sitePhoto").value="";
}

function renderSites() {
  const grid = document.getElementById("sitesGrid");
  grid.innerHTML="";
  sites.forEach(site=>{
    const card=document.createElement("div");
    card.className="site";
    card.innerHTML=`
      <strong>${site.title}</strong><br>
      ğŸ“ ${site.address}<br>
      ğŸ•— ${site.start}<br>
      <div class="droppable" data-id="${site.id}"></div>
    `;
    const dropzone=card.querySelector(".droppable");
    dropzone.addEventListener("dragover", e=>{e.preventDefault();dropzone.classList.add("dragover");});
    dropzone.addEventListener("dragleave", ()=>dropzone.classList.remove("dragover"));
    dropzone.addEventListener("drop", e=>{
      e.preventDefault();dropzone.classList.remove("dragover");
      const data=JSON.parse(e.dataTransfer.getData("text/plain"));
      site.crew.push(data);
      renderSites();
    });
    site.crew.forEach(c=>{
      const span=document.createElement("span");
      span.className="tag";
      span.textContent=(c.type==="ouvrier"?"ğŸ‘· ":"ğŸ› ï¸ ")+c.name;
      dropzone.appendChild(span);
    });
    grid.appendChild(card);
  });
}

function exportJSON() {
  const json=JSON.stringify(sites,null,2);
  const blob=new Blob([json],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="planning.json";
  a.click();
  URL.revokeObjectURL(a.href);
}
</script>
</body>
</html>
